<div class="fixed-grid has-2-cols">
  <div class="grid">
    <div class="cell">
      <form
        class="box"
        id="edit-user"
        hx-patch="http://127.0.0.1:8080/users"
        hx-swap="innerHTML"
        hx-headers='{"Content-Type": "application/json"}'
        hx-ext="json-enc"
        >
        <div class="field"> <!-- name -->
          <label class="label">Nombre</label>
          <div class="control has-icons-left">
            <input
              class="input"
              type="text"
              name="name"
              placeholder="Nombre"
              value="{{name}}"
            />
            <span class="icon is-small is-left">
              <i class="fas fa-user"></i>
            </span>
          </div>
        </div>

        <div class="field"> <!-- last_name -->
          <label class="label">Apellido</label>
          <div class="control has-icons-left">
            <input
              class="input"
              type="text"
              name="last_name"
              placeholder="Apellido"
              value="{{last_name}}"
            />
            <span class="icon is-small is-left">
              <i class="fas fa-user"></i>
            </span>
          </div>
        </div>

        <div class="field"> <!-- email -->
          <label class="label">Email</label>
          <div class="control has-icons-left">
            <input
              class="input"
              type="email"
              placeholder="Enter your email"
              name="email"
              value="{{email}}"
            />
            <span class="icon is-small is-left">
              <i class="fas fa-envelope"></i>
            </span>
          </div>
        </div>

        <div class="field"> <!-- email -->
          <label class="label">Password</label>
          <div class="control has-icons-left">
            <input
              class="input"
              type="password"
              hx-on:keyup="pwd_null_or_string()"
              placeholder="&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;"
              id="my-passwd"
              hx-vals="js:{deleted: false, password:null}"
            />
            <span class="icon is-small is-left">
              <i class="fas fa-key"></i>
            </span>
          </div>
        </div>

        <div class="field"> <!-- role -->
          <label class="label">Rol</label>
          <div class="control">
            <div class="select">
              <select name="role">
                <option
                  value="EDITOR"
                  {{#if (str_equal role_string "EDITOR")}} selected {{/if}}
                >
                      Editor
                  </option>
                <option
                  value="ADMIN"
                  {{#if (str_equal role_string "ADMIN")}} selected {{/if}}
                >
                    Admin
                </option>
              </select>
            </div>
          </div>
        </div>

        <div class="field"> <!-- notes -->
          <label class="label">Message</label>
          <div class="control">
            <textarea
              class="textarea"
              name="notes"
              placeholder="Enter your message"
            >{{notes}}</textarea>
          </div>
        </div>

        <!-- hidden_fields -->
        <input type="hidden" name="uuid" value="{{uuid}}" />
        <div class="field is-grouped">
          <div class="control">
            <button class="button is-link">Submit</button>
          </div>
          <div class="control">
            <button class="button is-link is-light">Cancel</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
function pwd_null_or_string() {
  const { value } = document.getElementById('my-passwd');
  const my_form = document.getElementById('edit-user');

  const hx_vals = value.length < 10 ? null : `'${value}'`;

  my_form.setAttribute("hx-vals", `js:{deleted: false, password: ${hx_vals}}`);
}
</script>
