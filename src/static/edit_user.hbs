<div class="box">
  <form
    id="edit-user"
    hx-patch="http://127.0.0.1:8080/users"
    hx-swap="innerHTML"
    hx-headers='{"Content-Type": "application/json"}'
    hx-ext="json-enc"
    hx-vals='{"deleted": false}'
  >
    <div class="field"> <!-- name -->
        <label class="label">Nombre</label>

      <div class="control has-icons-left">
        <input
          class="input"
          type="text"
          name="name"
          placeholder="Nombre"
          value="{{name}}"
          autocomplete="given-name"
        />

        <span class="icon is-small is-left">
          <i class="fas fa-user"></i>
        </span>
      </div>
    </div>

    <div class="field"> <!-- last_name -->
        <label class="label">Apellido</label>
      <div class="control has-icons-left">
          <input
          class="input"
          type="text"
          name="last_name"
          placeholder="Apellido"
          value="{{last_name}}"
          autocomplete="family-name"
        />
        <span class="icon is-small is-left">
          <i class="fas fa-user"></i>
        </span>

      </div>
    </div>

    <div class="field"> <!-- email -->

        <label class="label">Email</label>
      <div class="control has-icons-left">
          <input
          class="input"
          type="email"
          placeholder="Enter your email"
          name="email"
          value="{{email}}"
          autocomplete="email"
        />

        <span class="icon is-small is-left">
          <i class="fas fa-envelope"></i>
        </span>
      </div>
    </div>

    <div class="field"> <!-- email -->
        <label class="label">Password</label>
      <div class="control has-icons-left">
          <input
          class="input"
          type="password"
          hx-on:keyup="pwd_null_or_string()"
          placeholder="&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;"
          id="my-passwd"
          hx-vals="js:{deleted: false, password:null}"
        />

        <span class="icon is-small is-left">
          <i class="fas fa-key"></i>
        </span>
      </div>
    </div>

    <div class="field"> <!-- role -->
          <label class="label">Rol</label>
      <div class="control">
        <div class="select">
            <select name="role">
            <option
              value="EDITOR"
              {{#if (str_equal role_string "EDITOR")}} selected {{/if}}
            >
                  Editor
              </option>
            <option
              value="ADMIN"
              {{#if (str_equal role_string "ADMIN")}} selected {{/if}}
            >
                Admin
            </option>
          </select>

        </div>
      </div>
    </div>

    <div class="field"> <!-- notes -->
      <div class="control">
        <label class="label">Message<textarea
          class="textarea"
          name="notes"
          placeholder="Enter your message"
        >{{notes}}</textarea>
        </label>
      </div>
    </div>


    <!-- hidden_fields -->
    <input type="hidden" name="uuid" value="{{uuid}}" />
    <div class="field is-grouped">
      <div class="control">
        <button class="button is-link">Submit</button>
      </div>
      <div class="control">
        <button class="button is-link is-light">Cancel</button>
      </div>
    </div>
  </form>

</div>
<script>
function pwd_null_or_string() {
  const { value } = document.getElementById('my-passwd');
  const my_form = document.getElementById('edit-user');

  const hx_vals = value.length < 10 ? `{"hx-vals": false}` : `js:{deleted: false, password: "${value}"}`;
  my_form.setAttribute("hx-vals", hx_vals);
}
</script>
