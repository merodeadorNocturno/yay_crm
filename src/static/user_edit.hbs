<div class="box">
  <form
    id="edit-user"
    hx-patch="{{conf.server_protocol}}://{{conf.hbs_target_address}}:{{conf.server_port}}/users"
    hx-swap="innerHTML"
    hx-headers='{"Content-Type": "application/json"}'
    hx-ext="json-enc"
    hx-vals='{"deleted": false, "password": null}'
  >
    <div class="field is-horizontal"> <!-- name and last_name -->
      <div class="field-label is-normal">
        <label class="label">Nombre</label>
      </div> <!-- /field-label -->
      <div class="field-body">
        <div class="field"> <!-- name .field -->

          <div class="control has-icons-left">
            <input
              class="input"
              type="text"
              name="name"
              placeholder="Nombre"
              value="{{u.name}}"
              autocomplete="given-name"
            />

            <span class="icon is-small is-left">
              <i class="fas fa-user"></i>
            </span>
          </div> <!-- /name .control -->
        </div> <!-- /name .field -->

        <div class="field"> <!-- last_name -->
          <p class="control is-expanded has-icons-left has-icons-right">
              <input
              class="input"
              type="text"
              name="last_name"
              placeholder="Apellido"
              value="{{u.last_name}}"
              autocomplete="family-name"
            />
            <span class="icon is-small is-left">
              <i class="fas fa-user"></i>
            </span>
          </p> <!-- /last_name control -->
        </div> <!-- last_name -->
      </div> <!-- field-body -->
    </div> <!-- /is-horizonal -->


    <div class="field is-horizontal"> <!-- email -->
      <div class="field-label is-normal">
        <label class="label">e-mail</label>
      </div>

      <div class="field-body">

        <div class="field">

          <p class="control has-icons-left is-expanded">

            <input type="email" class="input" placeholder="Enter user's e-mail" name="email" autocomplete="email" value="{{u.email}}"/>
            <span class="icon is-small is-left">
              <i class="fas fa-envelope"></i>
            </span>
          </p>

        </div>

      </div>
    </div>


    <div class="field is-horizontal"> <!-- password and roles -->
      <div class="field-label is-normal">
        <label class="label">
          Password
        </label>
      </div>

      <div class="field-body">
        <div class="field">
          <p class="control has-icons-left is-normal">
            <input
              type="password"
              placeholder="&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;&#x2022;"
              class="input"
              hx-on:keyup="pwd_null_or_string()"
              id="my-passwd"
            >
            <span class="icon is-small is-left">
              <i class="fas fa-key"></i>
            </span>
          </p>
        </div>
        <div class="field">
          <p class="control has-icons-left">
          <div class="select">
            <select name="role">
              {{#each roles}}
                <option {{#if selected}} selected {{/if}} value="{{value}}">{{text}}</option>
              {{/each}}
            </select>
          </div>
          </p>
        </div>
      </div>
    </div>


    <div class="field is-horizontal"> <!-- notes -->
      <div class="field-label is-normal">
        <label class="label">Notas</label>
      </div>
      <div class="field-body">
        <div class="field">
          <p class="control is-expanded">

            <textarea name="notes" class="textarea is-expanded" placeholder="Escriba notas para este usuario">{{u.notes}}</textarea>

          </p>
        </div>

      </div>
    </div>



    <!-- hidden_fields -->
    <input type="hidden" name="uuid" value="{{u.uuid}}" />
    <div class="field is-grouped">
      <div class="control">
        <button class="button is-link">Submit</button>
      </div>
      <div class="control">
        <button class="button is-link is-light"
          hx-post="{{conf.server_protocol}}://{{conf.hbs_target_address}}:{{conf.server_port}}/user_htmx" hx-swap="innerHTML"
          hx-target="#dynamic-content"
        >Cancel</button>
      </div>
    </div>
  </form>
</div>

<script>
// function pwd_null_or_string() {
//   const { value } = document.getElementById('my-passwd');
//   const my_form = document.getElementById('edit-user');

//   const hx_vals = value.length < 10 ? `{"hx-vals": false}` : `js:{deleted: false, password: "${value}"}`;
//   my_form.setAttribute("hx-vals", hx_vals);
// }
</script>
